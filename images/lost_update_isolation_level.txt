@startuml
T1->BALANCE: BEGIN;
T1->BALANCE: SET TRANSACTION ISOLATION LEVEL REPEATABLE READ;
note right BALANCE: amount = 1000
T2->BALANCE: BEGIN;
T2->BALANCE: SET TRANSACTION ISOLATION LEVEL REPEATABLE READ;
T1->BALANCE: SELECT * WHERE id = 42;
T2->BALANCE: SELECT * WHERE id = 42;
T1->BALANCE: UPDATE balance SET amount = 900 WHERE id = 42;
T2->BALANCE: UPDATE balance SET amount = 1100 WHERE id = 42;
BALANCE-->T2: ERROR: could not serialize access due to concurrent update
T2->BALANCE: ROLLBACK;
T1->BALANCE: COMMIT;
note right BALANCE: amount = 900
@enduml
